<template>
    <div>
        <el-row :gutter="20" class="index-top">
            <!-- ç¬¬ä¸€è¡Œ -->
            <el-col :span="6">
                <div class="grid-content bg-purple">
                    <el-card shadow="always" class="item-01">
                        <!-- ç”¨æˆ·æ•°é‡ -->
                        <div class="item-01-top">
                            <img src="../../../assets/image/index-01.png" style="width:110px">
                            <div class="item-01-top-center">
                                <div style="color:#ffffff;font-size:20px;font-weight:bold">ç”¨æˆ·æ•°é‡</div>
                                <div style="color:#ffffff;font-size:30px;font-weight:bold">{{top.userNum}}äºº</div>
                            </div>
                        </div>
                        <div class="item-01-under">
                            <!-- <div style="color:#B1B7EA;font-size:14px;font-weight:bold">æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨</div> -->
                            <!-- <i class="el-icon-right" style="color:#B1B7EA;font-size:14px;font-weight:bold"></i> -->
                        </div>
                    </el-card>
                </div>
            </el-col>
            <el-col :span="6">
                <div class="grid-content bg-purple">
                    <el-card shadow="always" class="item-03">
                        <div class="item-01-top">
                            <img src="../../../assets/image/index-02.png" style="width:110px">
                            <div class="item-01-top-center">
                                <div style="color:#000000;font-size:20px;font-weight:bold">å­¦ç”Ÿæ•°é‡</div>
                                <div style="color:#000000;font-size:30px;font-weight:bold">{{top.studentNum}}äºº</div>
                            </div>
                        </div>
                        <div class="item-01-under" @click="toStudent()" 
                             style="cursor: pointer; transition: all 0.3s;">
                            <div style="color:black;font-size:14px;font-weight:bold;text-decoration: underline; text-underline-offset: 3px; ">æŸ¥çœ‹å…¨éƒ¨</div>
                            <i class="el-icon-right" style="color:black;font-size:14px;font-weight:bold"></i>
                        </div>
                    </el-card>
                </div>
            </el-col>
            <el-col :span="6">
                <div class="grid-content bg-purple">
                    <el-card shadow="always" class="item-05">
                        <div class="item-01-top">
                            <img src="../../../assets/image/avator.png" style="width:110px">
                            <div class="item-01-top-center">
                                <div style="color:#ffffff;font-size:20px;font-weight:bold">æ•™å¸ˆæ•°é‡</div>
                                <div style="color:#ffffff;font-size:30px;font-weight:bold">{{top.teacherNum}}äºº</div>
                            </div>
                        </div>
                        <div class="item-01-under" @click="toTeacher()" 
                             style="cursor: pointer; transition: all 0.3s;">
                            <div style="color:black;font-size:14px;font-weight:bold;text-decoration: underline;text-underline-offset: 3px; /* æ§åˆ¶ä¸‹åˆ’çº¿è·ç¦» */">æŸ¥çœ‹å…¨éƒ¨</div>
                            <i class="el-icon-right" style="color:black;font-size:14px;font-weight:bold"></i>
                        </div>
                    </el-card>
                </div>
            </el-col>
            <el-col :span="6">
                <div class="grid-content bg-purple">
                    <el-card shadow="always" class="item-06">
                        <div class="item-01-top">
                            <img src="../../../assets/image/index-05.png" style="width:110px">
                            <div class="item-01-top-center">
                                <div style="color:#000000;font-size:12px;font-weight:bold;display:flex;align-item:center">
                                    <img src="../../../assets/image/index-06.png" style="width:20px">ï¼šcsu
                                </div>
                                <div style="color:#000000;font-size:12px;font-weight:bold;display:flex;align-item:center">
                                    <img src="../../../assets/image/index-07.png" style="width:20px">ï¼šcsu
                                </div>
                            </div>
                        </div>
                        <div class="item-01-under">
                            <div style="color:black;font-size:14px;font-weight:bold">è”ç³»æˆ‘ä»¬</div>
                            <i class="el-icon-phone-outline" style="color:black;font-size:14px;font-weight:bold"></i>
                        </div>
                    </el-card>
                </div>
            </el-col>
        </el-row>
        <el-row :gutter="20" class="index-center">
            <el-col :span="16">
                <el-card shadow="always" class="item-07">
                  <div style="display: flex; justify-content: center; margin-bottom: 5px;">
                      <h3 style="color: #4A2B90; font-weight: bold; margin: 0; padding: 5px 0; font-size: 14px;">å­¦ç”Ÿé€‰è¯¾æ•°æ®å›¾</h3>
                  </div>
                    <div id="chart" style="height: 300px;">

                    </div>
                </el-card>
            </el-col>
            <el-col :span="8">
                <el-card shadow="always" class="item-08">
                    <div id="pie-chart">

                    </div>
                </el-card>
            </el-col>
        </el-row>
        <el-row :gutter="20" class="index-center-01">
            <el-col :span="24">
                <el-card shadow="always" class="item-09">
                    <el-table
                        :data="taskList"
                        :header-cell-style="{
              'color': '#4A2B90',
              'background-color': '#ECE9F4',
            }"
                        :row-style="{
              'color': '#888897',
              'font-size': '15px',
              'font-family':'é»‘ä½“'
            }"
                        stripe
                        style="width: 100%">
                        <el-table-column
                            prop="name"
                            label="è¯¾ç¨‹åç§°"
                        >
                        </el-table-column>
                        <el-table-column
                            prop="teacherName"
                            label="æ•™å¸ˆ"
                        >
                            <template slot-scope="scope">
                                <div style="display:flex;align-items: center">
                                    <img style="width:35px;height:35px" src="../../../assets/image/avator.png">
                                    <div style="margin-left:10px">{{scope.row.teacherName}}</div>
                                </div>
                            </template>
                        </el-table-column>
                                <el-table-column
                                    prop="major"
                                    label="ä¸“ä¸š"
                                    align="center">
                                    <template slot-scope="scope">
                                        <el-button 
                                            size="mini"
                                            style="
                                                background-color: #409EFF; 
                                                color: white;
                                                border-color: #409EFF;
                                                font-weight: bold;
                                                width: 50%;
                                                padding: 4px 0;
                                            ">
                                            {{scope.row.major}}
                                        </el-button>
                                    </template>
                                </el-table-column>
                                <el-table-column
                                    prop="classification"
                                    label="è¯¾ç¨‹åˆ†ç±»"
                                    align="center">
                                    <template slot-scope="scope">
                                        <el-button 
                                            size="mini" 
                                            style="
                                                background-color: #8470D1;
                                                color: white;
                                                width: 50%;
                                                border-color: #8470D1;
                                                font-weight: bold;
                                            ">
                                            {{scope.row.classification}}
                                        </el-button>
                                    </template>
                        </el-table-column>
                        <el-table-column
                            prop="num"
                            label="å­¦ç”Ÿæ•°é‡"
                            align="center">
                        </el-table-column>
                        <el-table-column
                            prop="createTime"
                            label="åˆ›å»ºæ—¶é—´"
                            align="center">
                        </el-table-column>
                    </el-table>
                </el-card>
            </el-col>
        </el-row>
      <el-row :gutter="20" class="index-under">
        <el-col :span="16">
          <el-card shadow="always" class="item-10">
            <div style="width:100%;height:50px;display:flex;justify-content: space-between">
              <span>è¯¾ç¨‹ åˆ—è¡¨</span>
              <el-button style="height:35px;background:#8470D1" size="mini" type="primary" @click="toTask()">æŸ¥çœ‹å…¨éƒ¨</el-button>
            </div>
            <div style="width:100%;height:260px">
              <el-row>
                <el-col class="item-10-item" :span="7" v-for="(item,index) in taskCard" :key="index">
                  <div style="width:100%;height:120px;overflow:hidden;border-radius:20px;margin-bottom:8px">
                    <img
                        :src="$store.state.configure.HOST + item.image"
                        style="width:100%;height:100%;object-fit:cover"
                    >
                  </div>
                  <div>{{item.name}}</div>
                  <div style="width:90%;display:flex;justify-content: space-around;">
                    <div style="height:35px;font-size:13px;display:flex;align-items:center">
                      <span>{{item.createTime}}</span>
                    </div>
                    <el-button size="mini" style="height:30px" type="danger">{{item.teacherName}}</el-button>
                  </div>
                </el-col>
              </el-row>
            </div>
          </el-card>
        </el-col>
        <el-col :span="8">
          <el-card shadow="always" class="item-11">
            <el-calendar v-model="today">
            </el-calendar>
          </el-card>
        </el-col>
      </el-row>
    </div>
</template>

<script>
import {getIndexData,getIndexSexData,getTaskChart,getTaskIndexList} from '../../../api/api'
import * as echarts from "echarts";
export default {
    data() {
        return{
            top: {},
            sex: [],
            tasks: [],
            nums: [],
            taskList: [],
            taskCard: [],
            today: new Date(),
            myChart: "",
            pieChart: "",
        }
    },
    methods: {
        toTask() {
            var param = {
                "name": "è¯¾ç¨‹ç®¡ç†",
                "url": "/task"
            }
            this.$store.commit('menu/addActiveMenu', param)
            this.$router.push("/task")
            this.$store.commit('menu/setActiveMenu', "/task")
        },
        toStudent() {
            var param = {
                "name": "å­¦ç”Ÿç®¡ç†",
                "url": "/student"
            }
            this.$store.commit('menu/addActiveMenu', param)
            this.$router.push("/student")
            this.$store.commit('menu/setActiveMenu', "/student")
        },
        toTeacher() {
            var param = {
                "name": "æ•™å¸ˆç®¡ç†",
                "url": "/teacher"
            }
            this.$store.commit('menu/addActiveMenu', param)
            this.$router.push("/teacher")
            this.$store.commit('menu/setActiveMenu', "/teacher")
        }
    },
    created() {

    },
    mounted() {
        getIndexData({type:0}).then(res => {
            if (res.code == 1000) {
                this.top = res.data
            }
        })
        getIndexSexData({type:0}).then(res => {
            if (res.code == 1000) {
                this.sex = res.data;
                this.pieChart = echarts.init(document.getElementById("pie-chart"));
                var optionPie = {
                    tooltip: { trigger: 'item' },
                    legend: { 
                        center: 'center',
                        textStyle: { color: '#666' } // æ·»åŠ å›¾ä¾‹æ–‡å­—é¢œè‰²
                    },
                    series: [{
                        name: 'å­¦ç”Ÿæ€§åˆ«åˆ†æ',
                        type: 'pie',
                        radius: '50%',
                        data: [
                            {
                                value: this.sex[0].value,
                                name: this.sex[0].name,
                                itemStyle: { 
                                    color: '#8470D1', // æµ…ç´«è‰²ï¼ˆç”·ï¼‰
                                    borderWidth: 2,
                                    borderColor: '#fff'
                                }
                            },
                            {
                                value: this.sex[1].value,
                                name: this.sex[1].name,
                                itemStyle: { 
                                    color: '#6A5ACD', // æ·±ç´«è‰²ï¼ˆå¥³ï¼‰
                                    borderWidth: 2,
                                    borderColor: '#fff'
                                }
                            }
                        ],
                        label: { // æ·»åŠ æ ‡ç­¾æ ·å¼
                            color: '#333',
                            fontSize: 14
                        },
                        emphasis: {
                            itemStyle: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.3)'
                            }
                        }
                    }]
                };
                this.pieChart.setOption(optionPie);
            }
        })
        getTaskChart({type:0}).then(res => {
          console.log("ğŸ“Š Chart Data:", res);

            if (res.code == 1000) {
                this.tasks = res.data.tasks
                this.nums = res.data.nums
                this.myChart = echarts.init(document.getElementById("chart"))
                var option = {
                    grid: {
                      left: '10%',
                      right: '5%',
                      top: '15%',
                      bottom: 5 , // â¬… è°ƒå¤§è¿™ä¸ªå€¼
                        //containLabel: true    // â† å…³é”®è®¾ç½®
                    },
                    tooltip: {
                        trigger: 'axis'
                    },
                    legend: {
                        data: ['å­¦ç”Ÿæ•°é‡', 'å­¦ç”Ÿæ•°é‡']
                    },
                    backgroundColor: '#fff',
                      xAxis: [{
                    type: 'category',
                    data: this.tasks,
                    axisLabel: {
                      show: false , // ğŸ‘ˆ éšè—æ¨ªè½´æ–‡å­—
                      interval: 0,
                      rotate: 90,     // â¬… å‚ç›´æ˜¾ç¤ºï¼ˆæ–‡å­—ç«–ç€ï¼‰
                      fontSize: 10,
                      formatter: function (value) {
                        return value; // ä¸åšæˆªæ–­æˆ–æ¢è¡Œï¼Œä¿æŒè‹±æ–‡å•è¯å®Œæ•´ä¸€è¡Œ
                      }
                    },
                    axisLine: {
                      lineStyle: {
                        color: 'rgba(107,107,107,0.37)'
                      }
                    },
                    axisTick: {
                      show: true
                    }
                  }]
                  ,
                      yAxis: [{
                          axisLine: {
                              lineStyle: {
                                  color: 'rgba(107,107,107,0.37)',
                              }
                          },
                          axisTick: {
                              show: true
                          },
                          splitLine: {
                              lineStyle: {
                                  color: 'rgba(131,101,101,0.2)',
                                  type: 'dashed',
                              }
                          }
                    }],
                    series: [{
                        data: this.nums,
                        type: 'line',
                        name: 'æŠ˜çº¿å›¾',
                        symbol: 'none',
                        areaStyle: {
                            color: "#E6F8EE"
                        },
                        lineStyle: {
                            color: '#3AC977',
                            width: 2,
                            shadowColor: 'rgba(0, 0, 0, 0.3)',//è®¾ç½®æŠ˜çº¿é˜´å½±
                            shadowBlur: 15,
                            shadowOffsetY: 20,
                        },
                        zlevel: 1
                    },{
                        type: 'bar',
                        data: this.nums,
                        barWidth: '15px',
                        name: 'æŸ±çŠ¶å›¾',
                        itemStyle: {
                            normal: {
                                color: function(params){//å±•ç¤ºæ­£å€¼çš„æŸ±å­ï¼Œè´Ÿæ•°è®¾ä¸ºé€æ˜
                                    let colorArr = params.value > 0?['#7866BE', '#7866BE']:['rgba(0,0,0,0)', 'rgba(0,0,0,0)']
                                    return new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
                                        offset: 0,
                                        color: colorArr[0] // 0% å¤„çš„é¢œè‰²
                                    }, {
                                        offset: 1,
                                        color:  colorArr[1]// 100% å¤„çš„é¢œè‰²
                                    }], false)
                                },
                                barBorderRadius: [30,30,0,0]
                            },
                        },
                        label: {
                            normal: {
                                show: true,
                                fontSize: 13,
                                color: '#333',
                                position: 'top',
                            }
                        },
                        zlevel: 2
                    }
                    ]
                };
                this.myChart.setOption(option);
            }
        })
        getTaskIndexList({type:0}).then(res => {
            if (res.code == 1000) {
                this.taskList = res.data.slice(0,5)
                this.taskCard = res.data.slice(0,3)
            }
        })
        var that = this
        window.onresize = function () {
          if (that.myChart && typeof that.myChart.resize === 'function') {
            that.myChart.resize();
          }
          if (that.pieChart && typeof that.pieChart.resize === 'function') {
            that.pieChart.resize();
          }
        }
    }
}
</script>

<style scoped>

/* é˜²æ­¢é¼ æ ‡å˜æˆæ–‡æœ¬è¾“å…¥ç¬¦å· */
.item-01-top, 
.item-01-top-center{
  cursor: default !important;
}

/* å›¾æ ‡æ‚¬åœæ”¾å¤§ */
.item-01-under i:hover {
  transform: scale(1.2);
  color: var(--primary-purple); /* æ‚¬åœå˜è‰² */
}

/* å…¨å±€é¢œè‰²å˜é‡ */
:root {
  --primary-purple: #6A5ACD;
  --light-purple: #8470D1;
  --dark-purple: #4B0082;
  --white: #ffffff;
  --light-bg: #F8F8FF;
}

/* åŸºç¡€å¸ƒå±€è°ƒæ•´ */
.index-top {
    height: 210px;
    margin-bottom: 20px;
}

/* å¡ç‰‡ç»Ÿä¸€æ ·å¼ */
.el-card {
    border-radius: 12px;
    border: none;
    box-shadow: 0 4px 12px rgba(106, 90, 205, 0.1);
}

/* é¡¶éƒ¨å¡ç‰‡ */
.item-01 {
    height: 170px;
    background: linear-gradient(135deg, #483D8B, #7B68EE);
    color: var(--white);
}

.item-03, .item-06 {
    height: 170px;
    background: var(--white);
    border: 1px solid rgba(106, 90, 205, 0.1);
}

.item-05 {
    height: 170px;
    background: linear-gradient(135deg, #5F4B8B, #8A2BE2);
    color: var(--white);
}

/* ä¸­é—´å›¾è¡¨åŒºåŸŸ */
.index-center {
    margin: 20px 0;
    height: 400px;
    border: 1px solid red !important;
}

.item-07, .item-08 {
    height: 400px;
    background: var(--white);
    border: 1px solid rgba(106, 90, 205, 0.1);
}

/* è¡¨æ ¼åŒºåŸŸ */
.index-center-01 {
    margin: 20px 0;
    height: 300px;
    border: 1px solid red !important;
}

.item-09 {
    height: 300px;
    background: var(--white);
    border: 1px solid rgba(106, 90, 205, 0.1);
    overflow: scroll;
}

/* åº•éƒ¨åŒºåŸŸ */
.index-under {
    margin-top: 20px;
    height: 400px;
    border: 1px solid red !important;
}

.item-10 {
    height: 350px;
    background: var(--white);
    border: 1px solid rgba(106, 90, 205, 0.1);
}

.item-11 {
    border-radius: 8px;
    height: 390px;
    background-color: #ffffff;
}

/* å¡ç‰‡å†…éƒ¨å¸ƒå±€ */
.item-01-top {
    height: 90px;
    display: flex;
    flex-direction: row;
    align-items: center;
    justify-content: space-around;
}

.item-01-top-center {
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: space-around;
}

.item-01-under {
    height: 60px;
    display: flex;
    flex-direction: row;
    align-items: center;
    justify-content: space-between;
    padding: 0 20px;
    cursor: pointer !important; /* ç¡®ä¿çˆ¶å®¹å™¨æ˜¯å°æ‰‹ */
}

/* è¯¾ç¨‹å¡ç‰‡ */
.item-10-item {
    border: 1px solid rgba(106, 90, 205, 0.2);
    border-radius: 20px;
    height: 100%;
    margin: 0 10px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: space-around;
    transition: all 0.3s;
}

.item-10-item:hover {
    transform: translateY(-5px);
    box-shadow: 0 5px 15px rgba(106, 90, 205, 0.2);
}

/* æŒ‰é’®æ ·å¼ */
.el-button--primary {
    background-color: var(--primary-purple);
    border-color: var(--primary-purple);
}

.el-button--primary:hover {
    background-color: var(--light-purple);
    border-color: var(--light-purple);
}

.el-button--danger {
    background-color: #FF6B6B;
    border-color: #FF6B6B;
}

/* è¡¨æ ¼æ ·å¼ */
.el-table {
    --el-table-header-bg-color: #F0EFFF;
    --el-table-header-text-color: var(--dark-purple);
    --el-table-border-color: rgba(106, 90, 205, 0.1);
}

/* æ»šåŠ¨æ¡éšè— */
.item-09::-webkit-scrollbar {
    width: 0px;
    height: 0px;
}

/* å›¾è¡¨å®¹å™¨ */
#chart, #pie-chart {
    width: 100%;
    height: 380px;
}

/* å¡ç‰‡æ‚¬åœæ”¾å¤§æ•ˆæœ */
.grid-content .el-card {
    transition: all 0.3s ease;
    transform-origin: center;
    cursor: pointer;
}

.grid-content .el-card:hover {
    transform: scale(1.05);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2) !important;
}

/* ç¡®ä¿å¡ç‰‡å†…å®¹ä¸ä¼šå› ä¸ºæ”¾å¤§è€Œæº¢å‡º */
.grid-content {
    overflow: hidden;
    border-radius: 12px;
}

/deep/ .el-calendar-day {
    height: 40px !important;
    border: none;
}

</style>